[
  {
    "objectID": "cases1_brazil.html",
    "href": "cases1_brazil.html",
    "title": "Case 01 â€“ Brazil (ðŸ‡§ðŸ‡·)",
    "section": "",
    "text": "Context\n\n\n\nBetween 2014 and 2021, the Brazilian Legal Amazon underwent intense environmental and anthropogenic transformations. On one hand, forest loss has accelerated due to logging, agriculture, and infrastructure expansion. At the same time, night-time lights â€”a proxy for urban growth and human activityâ€” have increased in frontier municipalities, signaling intensified land use. Concurrently, changes in evapotranspiration (SEBAL-MODIS) patterns suggest modifications in local moisture dynamics and energy balance, reflecting the cumulative impact of deforestation and land conversion."
  },
  {
    "objectID": "cases1_brazil.html#objective",
    "href": "cases1_brazil.html#objective",
    "title": "Case 01 â€“ Brazil (ðŸ‡§ðŸ‡·)",
    "section": "1 Objective",
    "text": "1 Objective\nVisualize indicators such as forest loss, human activity and evapotranspiration over time"
  },
  {
    "objectID": "cases1_brazil.html#functions-used",
    "href": "cases1_brazil.html#functions-used",
    "title": "Case 01 â€“ Brazil (ðŸ‡§ðŸ‡·)",
    "section": "2 Functions Used",
    "text": "2 Functions Used\n\n\n\n\n\n\n\n\nVariable\nFunction\nDescription\n\n\n\n\nForest loss\nl4h_forest_loss()\nAnnual forest cover loss\n\n\nNight-time lights\nl4h_night_lights()\nProxy of urbanization and anthropogenic pressure\n\n\nEvapotranspiration\nl4h_sebal_modis()\nSurface evapotranspiration from MODIS SEBAL"
  },
  {
    "objectID": "cases1_brazil.html#workflow",
    "href": "cases1_brazil.html#workflow",
    "title": "Case 01 â€“ Brazil (ðŸ‡§ðŸ‡·)",
    "section": "3 Workflow",
    "text": "3 Workflow\n\n3.1 Libraries\nWe need to verify and load all the necessary packages required for this case. It ensures that dependencies for spatial, environmental, and epidemiological analyses are properly installed and available. If any package is missing, install it manually with: install.packages()\n\n# --- Geospatial and environmental analysis ---\nlibrary(land4health)\nlibrary(geodata)\nlibrary(sf)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(rmapshaper)\nlibrary(mapview)\nlibrary(tmap)\n\n# --- Data manipulation and analysis ---\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(purrr)\nlibrary(ggrepel)\n\n# --- Visualization ---\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(RColorBrewer)\nlibrary(leaflet.extras2)\n\n\n# ee_Authenticate()   # Run once if not authenticated\nee_Initialize()\n\nâ”€â”€ rgee 1.1.7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ earthengine-api 0.1.317 â”€â”€ \n âœ” user: not_defined \n âœ” Initializing Google Earth Engine:\n âœ” Initializing Google Earth Engine:  DONE!\n\n âœ” Earth Engine account: users/yomali_ferreyra \n\n âœ” Python Path: C:/Users/yomal/AppData/Local/Programs/Python/Python39/python.exe \nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ \n\n\n\n\n3.2 Spatial data preparation\nWe first load and define the administrative boundaries that will serve as the spatial reference for all analyses. The shapefiles are retrieved from the GADM dataset via the geodata package. All departments from Brazil are selected as the study area.\n\nbrasil_sf &lt;- geodata::gadm(country = \"BRA\", level = 1, path = tempdir()) |&gt; \n  st_as_sf()|&gt; filter(NAME_1 %in%  c(\"ParÃ¡\",\"AmapÃ¡\",\"Amazonas\",\n                \"Mato Grosso\", \"RondÃ´nia\", \"Roraima\", \"Acre\", \"Tocantins\", \"MaranhÃ£o\"))\n\nbrasil_sf &lt;- rmapshaper::ms_simplify(brasil_sf, keep = 0.05)  \n\nrmapshaper::ms_simplify() function simplifies the spatial geometry by removing redundant vertices while maintaining the overall shape and topology of the polygons.\n\n\n3.3 Forest Loss\nWe need to use l4h_forest_loss() function which retrieves annual estimates of vegetation loss derived from the Global Forest Change (GFC) dataset developed by Hansen et al.Â (2013). In this case, the function extracts data for the period 2014â€“2021 within the administrative boundaries of Brazil (brasil_sf). Setting sf = TRUE returns the results as a spatial object (sf).\n\n# Loss of vegetation cover\nforest_loss &lt;-  l4h_forest_loss(\n  from = \"2014-01-01\",\n  to = \"2021-12-31\",\n  region = brasil_sf,\n  sf = TRUE)%&gt;%\n  mutate(year = year(date))\n\n\n\nCode\nforest_loss%&gt;%\n  st_transform(32723) %&gt;%\n  mutate(\n    X = st_coordinates(st_centroid(geometry))[,1],\n    Y = st_coordinates(st_centroid(geometry))[,2]\n  ) %&gt;%\n  ggplot() +\n  geom_sf(aes(fill = value), color = NA) +\n  geom_label(\n    data = . %&gt;% filter(value &gt;= 8000),\n    aes(x = X, y = Y, label = NAME_1, fill = value),\n    color = \"#333333\",        \n    size = 2.5,\n    fontface = \"bold\",\n    label.size = 0,         \n    alpha = 0.8             \n  ) +\n  scale_fill_gradientn(\n    colours = c(\"#00441B\", \"#1B7837\", \"#A6DBA0\", \"#FEE08B\", \"#E08214\", \"#B35806\"),\n    name = \"Forest loss (kmÂ²)\"\n  ) +\n  facet_wrap(~year, ncol = 4, nrow = 2) +\n  theme_minimal(base_size = 12) +\n  theme(\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"white\", color = NA),\n    strip.text = element_text(size = 11, face = \"bold\", color = \"#333333\"),\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"bottom\",\n    legend.key.width = unit(1, \"cm\"),\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 9)\n  )\n\n\n\n\n\n\n\n\n\nDuring the 2014â€“2021 period, ParÃ¡ consistently exhibits the largest forest loss, with peaks observed in 2016â€“2017, followed by a gradual decrease in subsequent years. Mato Grosso and MaranhÃ£o also show significant deforestation during these peak years. From 2018 onward, a relative reduction in forest loss is observed across most regions.\n\n\n3.4 Night-time Lights\nNight-time light (NTL) intensity serves as a proxy for human activity, urbanization, and energy use, providing insight into the dynamics of development and land transformation. Here we use l4h_night_lights() function, which retrieves annual composites of satellite-derived radiance data.\n\nnight_lights&lt;-l4h_night_lights(\n  from = \"2014-01-01\",\n  to = \"2021-12-31\",\n  region = brasil_sf,\n  stat = \"mean\"\n)%&gt;%\n  mutate(year = year(date))\n\n\n\nCode\ntm_shape(night_lights) +\n  tm_polygons(\n    col = \"value\",\n    palette = \"viridis\",\n    title = \"Radiance\\n(nW/cmÂ²/sr)\"\n  ) +\n  tm_facets(by = \"year\", ncol = 4, nrow = 2) \n\n\n\n\n\n\n\n\n\nStates in the southeastern and southern Amazon exhibit a gradual increase in brightness after 2019, indicating intensified human activity and urban expansion, whereas northern areas such as Amazonas and Roraima remain consistently low, reflecting limited electrification and preserved forest cover.\n\n\n3.5 Evapotranspiration\nEvapotranspiration quantifies the total water flux from land surfaces to the atmosphere, integrating soil evaporation and vegetation transpiration.\nTo estimate this variable, the function l4h_sebal_modis() will be use to derive mean annual evapotranspiration from MODIS-based SEBAL (Surface Energy Balance Algorithm for Land) data between 2014 and 2021.\n\nsebal_annual &lt;- l4h_sebal_modis(\n  from   = \"2014-01-01\",\n  to     = \"2021-12-31\",\n  by     = \"annual\",\n  fun    = \"mean\",\n  region = brasil_sf,\n  sf     = TRUE\n)%&gt;%\n  mutate(year = year(date))\n\n\n\nCode\nsebal_annual %&gt;%\n  st_transform(32723) %&gt;%\n  mutate(\n    X = st_coordinates(st_centroid(geometry))[,1],\n    Y = st_coordinates(st_centroid(geometry))[,2]\n  ) %&gt;%\n  ggplot() +\n  geom_sf(aes(fill = value), color = NA) +\n  geom_label(\n    data = . %&gt;% filter(value &gt;= 3500),\n    aes(x = X, y = Y, label = NAME_1, fill = value),\n    color = \"white\",        \n    size = 2.5,\n    fontface = \"bold\",\n    label.size = 0,         \n    alpha = 0.8             \n  ) +\n  scale_fill_gradientn(\n    colours = c(\"#87CEFA\", \"#4682B4\", \"#08306B\"),\n    name = \"Evapotranspiration (mm)\"\n  ) +\n  facet_wrap(~year, ncol = 4, nrow = 2) +\n  theme_minimal(base_size = 12) +\n  theme(\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"white\", color = NA),\n    strip.text = element_text(size = 11, face = \"bold\", color = \"#333333\"),\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"bottom\",\n    legend.key.width = unit(1, \"cm\"),\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 9)\n  )\n\n\n\n\n\n\n\n\n\nSpatial patterns derived from MODIS-based SEBAL data show relatively stable evapotranspiration rates over time, with consistently higher values observed in northern and northeastern states such as AmapÃ¡, ParÃ¡, and MaranhÃ£o. These regions exhibit strong vegetative activity and higher surface energy fluxes due to dense forest cover and humid climatic conditions.\n\n\n3.6 How can we see variation across variables?\nBivariate maps allow us to visualize how two environmental or socioeconomic variables interact spatially over time.\nInstead of analyzing them independently, this approach overlays both indicators using a combined color scale, where each color represents a specific combination of quartiles of the two variables.\nIn this analysis, we use bivariate color maps to explore spatial associations between indicators such as:\n\nEvapotranspiration (biophysical factor)\n\nNight-time lights (human activity proxy)\n\nForest loss, precipitation, or accessibility (contextual drivers)\n\n\n\nCode\nplot_bivariate_facet &lt;- function(\n  data1, data2,\n  var1_label = \"Variable 1\",\n  var2_label = \"Variable 2\",\n  years = NULL,\n  scale_type = \"quartile\",     \n  pal_var1 = NULL,  \n  pal_var2 = NULL,  \n  ncol_facets = 4,\n  legend_pos = \"right\"\n) {\n  library(sf)\n  library(dplyr)\n  library(ggplot2)\n  library(scales)\n  library(cowplot)\n  \n  if (is.null(years)) years &lt;- sort(unique(data1$year))\n\n  biv_data &lt;- data1 %&gt;%\n    select(NAME_1, geometry, year, var1 = value) %&gt;%\n    left_join(\n      data2 %&gt;%\n        st_drop_geometry() %&gt;%\n        select(NAME_1, year, var2 = value),\n      by = c(\"NAME_1\", \"year\")\n    ) %&gt;%\n    filter(year %in% years) %&gt;%\n    st_as_sf()\n\n  n_breaks &lt;- switch(scale_type,\n                     \"tertile\"  = 3,\n                     \"quartile\" = 4,\n                     \"quintile\" = 5,\n                     \"decile\"   = 10,\n                     4)\n\n  probs &lt;- seq(0, 1, 1 / n_breaks)\n  v1_qtiles &lt;- quantile(biv_data$var1, probs = probs, na.rm = TRUE)\n  v2_qtiles &lt;- quantile(biv_data$var2, probs = probs, na.rm = TRUE)\n\n  biv_data &lt;- biv_data %&gt;%\n    mutate(\n      v1_class = cut(var1, breaks = v1_qtiles, include.lowest = TRUE, labels = 1:n_breaks),\n      v2_class = cut(var2, breaks = v2_qtiles, include.lowest = TRUE, labels = 1:n_breaks),\n      bi_class = paste0(v1_class, \"-\", v2_class)\n    )\n\n  make_bi_pal &lt;- function(pal1, pal2, n = n_breaks) {\n    col1 &lt;- colorRampPalette(pal1)(n)\n    col2 &lt;- colorRampPalette(pal2)(n)\n    outer(seq_len(n), seq_len(n), Vectorize(function(i, j) {\n      rgb(\n        (col2rgb(col1[i])[1] + col2rgb(col2[j])[1]) / 510,\n        (col2rgb(col1[i])[2] + col2rgb(col2[j])[2]) / 510,\n        (col2rgb(col1[i])[3] + col2rgb(col2[j])[3]) / 510\n      )\n    }))\n  }\n\n  bi_pal &lt;- make_bi_pal(pal_var1, pal_var2)\n  bi_colors &lt;- as.vector(t(bi_pal))\n\n  color_map &lt;- expand.grid(v1_class = 1:n_breaks, v2_class = 1:n_breaks) %&gt;%\n    mutate(bi_class = paste0(v1_class, \"-\", v2_class),\n           fill = bi_colors)\n\n  biv_data &lt;- left_join(biv_data, color_map, by = \"bi_class\")\n\n  map_faceted &lt;- ggplot(biv_data) +\n    geom_sf(aes(fill = fill), color = \"white\", size = 0.05) +\n    scale_fill_identity() +\n    facet_wrap(~year, ncol = ncol_facets) +\n    theme_void() +\n    theme(\n      plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n      strip.text = element_text(face = \"bold\", size = 10),\n      panel.spacing = unit(0.4, \"lines\")\n    )\n  legend_df &lt;- expand.grid(v1_class = 1:n_breaks, v2_class = 1:n_breaks) %&gt;%\n    mutate(fill = as.vector(t(bi_pal)))\n\n  legend_plot &lt;- ggplot(legend_df, aes(x = v1_class, y = v2_class, fill = fill)) +\n    geom_tile(color = \"white\") +\n    scale_fill_identity() +\n    coord_equal() +\n    theme_void() +\n    theme(plot.margin = margin(10, 10, 10, 10)) +\n    annotate(\"segment\", x = 1, xend = n_breaks + 0.5, y = 0.3, yend = 0.3,\n             arrow = arrow(length = unit(0.25, \"cm\")), color = \"black\", size = 0.6) +\n    annotate(\"segment\", x = 0.3, xend = 0.3, y = 1, yend = n_breaks + 0.5,\n             arrow = arrow(length = unit(0.25, \"cm\")), color = \"black\", size = 0.6) +\n    annotate(\"text\", x = (n_breaks + 1) / 2, y = -0.2,\n             label = paste0(var1_label, \" (Q1â€“Q\", n_breaks, \")\"),\n             size = 2, fontface = \"bold\") +\n    annotate(\"text\", x = 0, y = (n_breaks + 1) / 2,\n             label = paste0(var2_label, \" (Q1â€“Q\", n_breaks, \")\"),\n             size = 2, fontface = \"bold\", angle = 90)\n  if (legend_pos == \"right\") {\n    out &lt;- cowplot::plot_grid(map_faceted, legend_plot,\n                              ncol = 2,\n                              rel_widths = c(0.8, 0.22),\n                              align = \"h\")\n  } else {\n    out &lt;- cowplot::ggdraw() +\n      draw_plot(map_faceted, 0, 0, 1, 1) +\n      draw_plot(legend_plot, 0.75, 0.05, 0.25, 0.25)\n  }\n\n  return(out)\n}\n\nplot_bivariate_facet(\n  sebal_annual, forest_loss,\n  var1_label = \"Evapotranspiration\",\n  var2_label = \"Forest loss\",\n  scale_type = \"quartil\",\n  pal_var1 = c(\"#87CEFA\", \"#4682B4\", \"#08306B\"),     # azul\n  pal_var2 = c(\"#00441B\", \"#1B7837\", \"#A6DBA0\", \"#FEE08B\", \"#E08214\", \"#B35806\")      \n)"
  }
]